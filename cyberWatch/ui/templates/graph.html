{% extends "base.html" %}

{% block content %}
</main>
<!-- Close the default cw-page main container and create our own full-viewport layout -->

<div class="cw-graph-container">
  <!-- Sidebar with controls and filters -->
  <aside class="cw-graph-sidebar">
    <div class="cw-card">
      <div class="cw-card-header">
        <p class="cw-eyebrow">Network topology</p>
        <h2 class="cw-h2">ASN Explorer</h2>
      </div>
      
      <div id="graph-status" class="cw-banner"></div>
      
      <!-- View mode toggle -->
      <div class="cw-control-group">
        <label class="cw-label">View Mode</label>
        <div class="cw-button-group">
          <button id="btn-top-asns" class="cw-btn-toggle active">Top ASNs</button>
          <button id="btn-explore-asn" class="cw-btn-toggle">Explore ASN</button>
        </div>
      </div>
      
      <!-- Explore ASN form (hidden by default) -->
      <form id="explore-form" class="cw-form" style="display: none;">
        <label for="explore-asn">Starting ASN</label>
        <input type="number" id="explore-asn" name="asn" placeholder="13335" min="1">
        
        <label for="depth">Exploration Depth</label>
        <select id="depth" name="depth">
          <option value="1">1 hop</option>
          <option value="2">2 hops</option>
          <option value="3">3 hops</option>
        </select>
        
        <button type="submit" class="cw-btn-primary">Explore</button>
      </form>
      
      <!-- Filters -->
      <div class="cw-control-group">
        <label class="cw-label">Sort By</label>
        <select id="sort-by" class="cw-select">
          <option value="traffic">Traffic Volume</option>
          <option value="neighbors">Neighbor Count</option>
          <option value="rtt">Avg RTT</option>
          <option value="country">Country</option>
        </select>
      </div>
      
      <div class="cw-control-group">
        <label class="cw-label">Filter by Country</label>
        <input type="text" id="country-filter" class="cw-input" placeholder="US, DE, etc." maxlength="2">
      </div>
      
      <div class="cw-control-group">
        <label class="cw-label">Max ASNs</label>
        <input type="number" id="limit" class="cw-input" value="20" min="5" max="100">
      </div>
      
      <button id="btn-apply-filters" class="cw-btn-secondary">Apply Filters</button>
      <button id="btn-reset-view" class="cw-btn-secondary">Reset View</button>
      
      <!-- Stats summary -->
      <div id="topology-stats" class="cw-stats-panel">
        <div class="cw-stat-item">
          <span class="cw-stat-label">ASNs Visible</span>
          <span class="cw-stat-value" id="stat-asn-count">0</span>
        </div>
        <div class="cw-stat-item">
          <span class="cw-stat-label">Connections</span>
          <span class="cw-stat-value" id="stat-edge-count">0</span>
        </div>
        <div class="cw-stat-item">
          <span class="cw-stat-label">Total Traffic</span>
          <span class="cw-stat-value" id="stat-total-traffic">0</span>
        </div>
      </div>
    </div>
  </aside>
  
  <!-- Main topology canvas -->
  <main class="cw-graph-main">
    <!-- Zoom controls -->
    <div class="cw-zoom-controls">
      <button id="btn-zoom-in" class="cw-zoom-btn" title="Zoom In">+</button>
      <button id="btn-zoom-reset" class="cw-zoom-btn" title="Reset Zoom">⊙</button>
      <button id="btn-zoom-out" class="cw-zoom-btn" title="Zoom Out">−</button>
    </div>
    
    <!-- Topology visualization area -->
    <div id="topology-canvas" class="cw-topology-canvas">
      <svg id="topology-svg" class="cw-topology-svg">
        <defs>
          <linearGradient id="edge-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" style="stop-color:#7cf3ff;stop-opacity:0.3" />
            <stop offset="100%" style="stop-color:#9f7fff;stop-opacity:0.3" />
          </linearGradient>
          <filter id="glow">
            <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
            <feMerge>
              <feMergeNode in="coloredBlur"/>
              <feMergeNode in="SourceGraphic"/>
            </feMerge>
          </filter>
        </defs>
        <g id="edges-group"></g>
      </svg>
      <div id="nodes-container" class="cw-nodes-container"></div>
      <div id="loading-overlay" class="cw-loading-overlay">
        <div class="cw-loader"></div>
        <p>Loading topology...</p>
      </div>
    </div>
  </main>
  
  <!-- Detail panel (slides in from right) -->
  <aside id="detail-panel" class="cw-detail-panel">
    <div class="cw-detail-header">
      <h3 id="detail-title">ASN Details</h3>
      <button id="btn-close-detail" class="cw-close-btn">&times;</button>
    </div>
    <div id="detail-content" class="cw-detail-content">
      <!-- Content populated by JavaScript -->
    </div>
  </aside>
</div>

<main class="cw-page" style="display: none;">
<!-- Reopen the main container for base.html structure -->
{% endblock %}

{% block scripts %}
<script src="/static/js/topology.js"></script>
{% endblock %}
